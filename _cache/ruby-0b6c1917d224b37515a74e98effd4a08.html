<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">attributes_for_view</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attributes</span><span class="p">)</span>
  <span class="c1"># This first inject will return the hash we want, with the value</span>
  <span class="c1"># of the label as the key and the attribute as the value</span>
  <span class="n">attributes</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">inject</span><span class="p">({})</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="p">,</span><span class="n">attribute_pair</span><span class="o">|</span>
    <span class="c1"># In order to do this, we first need to get the attribute.</span>
    <span class="c1"># We do the split in order to get nested objects. But we are</span>
    <span class="c1"># always starting with our root object, `obj`.</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">attribute_pair</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute</span><span class="o">|</span>
      <span class="n">obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Skip this value if it is nil</span>
    <span class="k">unless</span> <span class="n">value</span><span class="o">.</span><span class="n">nil?</span> 
      <span class="c1"># Strings we want to keep as is</span>
      <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">value</span><span class="o">.</span><span class="n">blank?</span>
        <span class="n">r</span><span class="o">[</span><span class="n">attribute_pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]]</span> <span class="o">=</span> <span class="n">value</span>

      <span class="c1"># For us, most of our numbers where dollar values. </span>
      <span class="c1"># So rather than creating a custom `_string` method for each, </span>
      <span class="c1"># it was easier to handle the case where the number </span>
      <span class="c1"># shouldnt&#39; be a dollar value.</span>
      <span class="k">elsif</span> <span class="n">value</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="nb">Integer</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">r</span><span class="o">[</span><span class="n">attribute_pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]]</span> <span class="o">=</span> <span class="n">number_to_currency</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># return the hash to continue building</span>
    <span class="n">r</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
